<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìˆ˜í•™ ë°°í‹€</title>
  <style>
    :root{
      --bg:#0f1220; --panel:#171a2b; --line:rgba(255,255,255,.12);
      --text:#f2f4ff; --muted:rgba(242,244,255,.7);
      --good:#43e28b; --bad:#ff5b6a; --accent:#557CF3;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 800px at 30% 20%, #1a2050, var(--bg));
      font-family: system-ui, -apple-system, Apple SD Gothic Neo, "Noto Sans KR", sans-serif;
      color:var(--text);
      padding:18px;
    }
    .wrap{width:min(920px, 96vw); display:grid; gap:14px; grid-template-columns: 1.2fr .8fr;}
    .card{
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:18px;
      padding:16px;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px;}
    .brand{font-weight:800; letter-spacing:.08em}
    .tiny{font-size:12px; color:var(--muted)}
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn:hover{background:rgba(255,255,255,.09)}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .bar{
      flex:1;
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      border-radius:999px;
      height:14px;
      overflow:hidden;
      min-width:180px;
    }
    .fill{height:100%; width:50%; background:linear-gradient(90deg, var(--accent), #4BACC6);}
    .fill.good{background:linear-gradient(90deg, #2bdc7a, #7cf7b6);}
    .fill.bad{background:linear-gradient(90deg, #ff4d63, #ff9aa6);}
    .grid{
      display:grid; gap:12px;
      grid-template-columns: 1fr 1fr;
      margin-top:12px;
    }
    .arena{
      display:grid; gap:12px;
      grid-template-columns: 1fr;
    }
    .stage{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height:280px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .char{
      width:42%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      user-select:none;
    }
    .char .emoji{font-size:72px; filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));}
    .name{font-weight:800}
    .hptext{font-size:12px; color:var(--muted)}
    .mid{
      width:16%;
      text-align:center;
      font-weight:900;
      letter-spacing:.04em;
      color:rgba(255,255,255,.85);
    }
    .flash{
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      transition:opacity .2s ease;
    }
    .flash.good{background:rgba(67,226,139,.18)}
    .flash.bad{background:rgba(255,91,106,.18)}
    .shake{animation:shake .25s linear 1}
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(-6px)}
      50%{transform:translateX(6px)}
      75%{transform:translateX(-4px)}
      100%{transform:translateX(0)}
    }
    .qa{
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
    }
    .q{
      font-size:26px; font-weight:900;
      display:flex; align-items:baseline; justify-content:space-between; gap:10px;
    }
    .q .timer{
      font-size:14px; font-weight:900;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(255,255,255,.05);
      min-width:88px;
      text-align:center;
    }
    .help{margin-top:6px; color:var(--muted); font-size:13px; line-height:1.4}
    .ans{
      display:flex; gap:10px; margin-top:12px;
    }
    input[type="number"]{
      flex:1;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--text);
      font-size:18px;
      outline:none;
    }
    input[type="number"]::placeholder{color:rgba(242,244,255,.35)}
    .primary{
      background:linear-gradient(90deg, var(--accent), #4BACC6);
      border:none;
    }
    .primary:hover{filter:brightness(1.05)}
    .side .stat{
      display:grid; gap:10px;
    }
    .pill{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    .big{font-size:22px; font-weight:900}
    .mono{font-variant-numeric: tabular-nums;}
    .settings{display:grid; gap:10px; margin-top:12px;}
    select{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--text);
      font-weight:800;
    }
    .log{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:rgba(0,0,0,.18);
      min-height:92px;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
      overflow:auto;
    }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      font-size:12px;
      color:rgba(242,244,255,.85);
      font-weight:800;
    }
    @media (max-width:860px){
      .wrap{grid-template-columns:1fr}
      .char .emoji{font-size:64px}
      .q{font-size:24px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div>
          <div class="brand">MATH BATTLE</div>
          <div class="tiny">ì´ˆë“± ì €í•™ë…„ Â· ì‚¬ì¹™ì—°ì‚°</div>
        </div>
        <div class="row">
          <span class="tag" id="stageTag">ìŠ¤í…Œì´ì§€ 1</span>
          <button class="btn" id="resetBtn">ì²˜ìŒë¶€í„°</button>
        </div>
      </div>

      <div class="arena">
        <div class="row">
          <div style="min-width:120px; font-weight:900">ì£¼ì¸ê³µ HP</div>
          <div class="bar" aria-label="hero hp"><div id="heroBar" class="fill good"></div></div>
          <div class="mono" id="heroHpTxt" style="min-width:68px; text-align:right; font-weight:900;">100</div>
        </div>
        <div class="row">
          <div style="min-width:120px; font-weight:900">ëª¬ìŠ¤í„° HP</div>
          <div class="bar" aria-label="mob hp"><div id="mobBar" class="fill bad"></div></div>
          <div class="mono" id="mobHpTxt" style="min-width:68px; text-align:right; font-weight:900;">60</div>
        </div>

        <div class="stage" id="stage">
          <div class="flash good" id="flashGood"></div>
          <div class="flash bad" id="flashBad"></div>

          <div class="char" id="hero">
            <div class="emoji" id="heroEmoji">ğŸ§’</div>
            <div class="name">ì£¼ì¸ê³µ</div>
            <div class="hptext" id="heroState">ì¤€ë¹„!</div>
          </div>

          <div class="mid" id="midText">VS</div>

          <div class="char" id="mob">
            <div class="emoji" id="mobEmoji">ğŸ‘¾</div>
            <div class="name" id="mobName">ìŠ¬ë¼ì„</div>
            <div class="hptext" id="mobState">ë¤ë²¼!</div>
          </div>
        </div>

        <div class="qa">
          <div class="q">
            <div id="question">ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
            <div class="timer mono" id="timer">â± 10.0</div>
          </div>
          <div class="help" id="help">
            ì •ë‹µì„ ì…ë ¥í•˜ê³  <b>ê³µê²©!</b>ì„ ëˆ„ë¥´ì„¸ìš”. (ì—”í„°ë„ ê°€ëŠ¥)
          </div>
          <div class="ans">
            <input id="answer" type="number" inputmode="numeric" placeholder="ì •ë‹µ" />
            <button class="btn primary" id="attackBtn">ê³µê²©!</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card side">
      <div class="stat">
        <div class="pill">
          <div>
            <div class="tiny">ì ìˆ˜</div>
            <div class="big mono" id="score">0</div>
          </div>
          <div style="text-align:right">
            <div class="tiny">ì—°ì† ì •ë‹µ</div>
            <div class="big mono" id="streak">0</div>
          </div>
        </div>

        <div class="pill">
          <div>
            <div class="tiny">ë‚œì´ë„</div>
            <div class="big" id="diffTxt">ì‰¬ì›€</div>
          </div>
          <div style="text-align:right">
            <div class="tiny">ë‚¨ì€ ë¬¸ì œ</div>
            <div class="big mono" id="remainTxt">5</div>
          </div>
        </div>
      </div>

      <div class="settings">
        <select id="difficulty">
          <option value="easy" selected>ì‰¬ì›€ (0~10)</option>
          <option value="normal">ë³´í†µ (0~20)</option>
          <option value="hard">ì–´ë ¤ì›€ (0~50)</option>
        </select>
        <select id="ops">
          <option value="mix" selected>ì‚¬ì¹™ í˜¼í•©</option>
          <option value="add">ë§ì…ˆë§Œ</option>
          <option value="sub">ëº„ì…ˆë§Œ</option>
          <option value="mul">ê³±ì…ˆë§Œ</option>
          <option value="div">ë‚˜ëˆ—ì…ˆ(ë”± ë–¨ì–´ì§)</option>
        </select>
      </div>

      <div class="log" id="log"></div>
      <div class="tiny" style="margin-top:10px;">
        íŒ: NFC í‚¤ë§ì—ëŠ” GitHub Pages ì£¼ì†Œë¥¼ ë„£ìœ¼ë©´ â€œíƒœê·¸ â†’ ê²Œì„ ì‹¤í–‰â€.
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------- ìƒíƒœ ----------
  const state = {
    stage: 1,
    heroHp: 100,
    heroMax: 100,
    mobHp: 60,
    mobMax: 60,
    score: 0,
    streak: 0,
    remain: 5,           // ìŠ¤í…Œì´ì§€ë‹¹ ë¬¸ì œ ìˆ˜
    timeLimit: 10.0,     // ì´ˆ
    timer: 10.0,
    ticking: null,
    current: null,       // {q, a}
    difficulty: 'easy',
    ops: 'mix'
  };

  const mobs = [
    { name:'ìŠ¬ë¼ì„', emoji:'ğŸ‘¾', hp: 60 },
    { name:'ê³ ë¸”ë¦°', emoji:'ğŸ§Ÿ', hp: 75 },
    { name:'ë“œë˜ê³¤', emoji:'ğŸ²', hp: 90 },
    { name:'ë³´ìŠ¤',   emoji:'ğŸ’€', hp: 110 }
  ];

  // ---------- ì—˜ë¦¬ë¨¼íŠ¸ ----------
  const $ = (id) => document.getElementById(id);
  const heroBar = $('heroBar'), mobBar = $('mobBar');
  const heroHpTxt = $('heroHpTxt'), mobHpTxt = $('mobHpTxt');
  const question = $('question'), timerEl = $('timer'), ans = $('answer');
  const attackBtn = $('attackBtn'), resetBtn = $('resetBtn');
  const logEl = $('log');
  const scoreEl = $('score'), streakEl = $('streak');
  const remainTxt = $('remainTxt'), diffTxt = $('diffTxt'), stageTag = $('stageTag');
  const heroState = $('heroState'), mobState = $('mobState');
  const mobName = $('mobName'), mobEmoji = $('mobEmoji');
  const stageEl = $('stage');
  const flashGood = $('flashGood'), flashBad = $('flashBad');
  const difficultySel = $('difficulty'), opsSel = $('ops');

  // ---------- ìœ í‹¸ ----------
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const rint = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;

  function log(msg){
    const t = new Date();
    const hh = String(t.getHours()).padStart(2,'0');
    const mm = String(t.getMinutes()).padStart(2,'0');
    logEl.innerHTML = `<div>[${hh}:${mm}] ${msg}</div>` + logEl.innerHTML;
  }

  function setBars(){
    heroHpTxt.textContent = state.heroHp;
    mobHpTxt.textContent = state.mobHp;
    heroBar.style.width = (state.heroHp / state.heroMax * 100) + '%';
    mobBar.style.width = (state.mobHp / state.mobMax * 100) + '%';
  }

  function diffConfig(){
    if(state.difficulty === 'easy')  return {max:10, mulMax:5, time:10.0};
    if(state.difficulty === 'normal')return {max:20, mulMax:9, time:9.0};
    return {max:50, mulMax:12, time:8.0};
  }

  function generateQuestion(){
    const cfg = diffConfig();
    const opMode = state.ops;

    let op = opMode;
    if(opMode === 'mix'){
      const ops = ['add','sub','mul','div'];
      op = ops[rint(0, ops.length-1)];
    }

    let a,b,q,answ;

    if(op === 'add'){
      a = rint(0, cfg.max);
      b = rint(0, cfg.max);
      q = `${a} + ${b} = ?`;
      answ = a + b;
    } else if(op === 'sub'){
      a = rint(0, cfg.max);
      b = rint(0, cfg.max);
      if(b > a) [a,b] = [b,a]; // ìŒìˆ˜ ë°©ì§€
      q = `${a} - ${b} = ?`;
      answ = a - b;
    } else if(op === 'mul'){
      a = rint(0, cfg.mulMax);
      b = rint(0, cfg.mulMax);
      q = `${a} Ã— ${b} = ?`;
      answ = a * b;
    } else { // div: ë”± ë–¨ì–´ì§€ê²Œ
      b = rint(1, cfg.mulMax);
      answ = rint(0, cfg.mulMax);
      a = b * answ;
      q = `${a} Ã· ${b} = ?`;
    }

    return { q, a: answ };
  }

  // ---------- íƒ€ì´ë¨¸ ----------
  function stopTimer(){
    if(state.ticking) clearInterval(state.ticking);
    state.ticking = null;
  }
  function startTimer(){
    stopTimer();
    state.timer = diffConfig().time;
    timerEl.textContent = `â± ${state.timer.toFixed(1)}`;

    state.ticking = setInterval(() => {
      state.timer = Math.max(0, state.timer - 0.1);
      timerEl.textContent = `â± ${state.timer.toFixed(1)}`;
      if(state.timer <= 0){
        stopTimer();
        onWrong('ì‹œê°„ ì´ˆê³¼!');
      }
    }, 100);
  }

  // ---------- ì „íˆ¬ ì—°ì¶œ ----------
  function flash(kind){
    const el = (kind === 'good') ? flashGood : flashBad;
    el.style.opacity = '1';
    setTimeout(() => el.style.opacity = '0', 170);
  }
  function shake(el){
    el.classList.remove('shake');
    void el.offsetWidth;
    el.classList.add('shake');
  }

  // ---------- ì •ë‹µ/ì˜¤ë‹µ ì²˜ë¦¬ ----------
  function onCorrect(){
    flash('good');
    shake($('mob'));
    heroState.textContent = 'ê³µê²© ì„±ê³µ!';
    mobState.textContent = 'ì•„ì•¼!';

    const baseDmg = 12;
    const bonus = Math.min(10, state.streak * 2);
    const dmg = baseDmg + bonus;

    state.mobHp = clamp(state.mobHp - dmg, 0, state.mobMax);

    state.score += 10 + bonus;
    state.streak += 1;
    state.remain -= 1;

    log(`âœ… ì •ë‹µ! ë°ë¯¸ì§€ ${dmg} (ì—°ì† ${state.streak})`);
    afterAction();
  }

  function onWrong(reason='ì˜¤ë‹µ!'){
    flash('bad');
    shake($('hero'));
    heroState.textContent = 'í”¼ê²©â€¦';
    mobState.textContent = 'í—¤í—·!';

    const dmg = 10;
    state.heroHp = clamp(state.heroHp - dmg, 0, state.heroMax);

    state.streak = 0;
    state.remain -= 1;

    log(`âŒ ${reason} HP -${dmg}`);
    afterAction();
  }

  function afterAction(){
    setBars();
    scoreEl.textContent = state.score;
    streakEl.textContent = state.streak;
    remainTxt.textContent = state.remain;

    ans.value = '';
    ans.focus();

    if(state.heroHp <= 0){
      gameOver(false);
      return;
    }
    if(state.mobHp <= 0){
      nextStage();
      return;
    }
    if(state.remain <= 0){
      // ë¬¸ì œ ìˆ˜ ëë‚˜ë©´ ëª¬ìŠ¤í„° ë‚¨ì•„ë„ ë‹¤ìŒ(ì•„ì´ ì¹œí™”ì ìœ¼ë¡œ â€œìŠ¤í…Œì´ì§€ í†µê³¼â€ ëŠë‚Œ)
      nextStage();
      return;
    }

    // ë‹¤ìŒ ë¬¸ì œ
    state.current = generateQuestion();
    question.textContent = state.current.q;
    startTimer();
  }

  function gameOver(win){
    stopTimer();
    attackBtn.disabled = true;
    ans.disabled = true;

    if(win){
      heroState.textContent = 'ìŠ¹ë¦¬!';
      mobState.textContent = 'ì¿¨ëŸ­â€¦';
      log(`ğŸ† í´ë¦¬ì–´! ìµœì¢… ì ìˆ˜ ${state.score}`);
      question.textContent = 'ğŸ‰ ì¶•í•˜í•´ìš”! ëª¨ë‘ ë¬¼ë¦¬ì³¤ì–´ìš”!';
    } else {
      heroState.textContent = 'ê¸°ì ˆâ€¦';
      mobState.textContent = 'ë‚´ê°€ ì´ê²¼ë‹¤!';
      log(`ğŸ’¥ ê²Œì„ ì˜¤ë²„! ìµœì¢… ì ìˆ˜ ${state.score}`);
      question.textContent = 'ğŸ’¥ ê²Œì„ ì˜¤ë²„! ë‹¤ì‹œ í•´ë³¼ê¹Œìš”?';
    }
    timerEl.textContent = 'â± --.-';
  }

  function nextStage(){
    stopTimer();

    // ìŠ¤í…Œì´ì§€ ì¦ê°€
    state.stage += 1;
    stageTag.textContent = `ìŠ¤í…Œì´ì§€ ${state.stage}`;

    // ëª¬ìŠ¤í„° êµì²´/ìŠ¤ì¼€ì¼ë§
    const m = mobs[Math.min(mobs.length-1, state.stage-1)];
    const extra = (state.stage-1) * 8;
    state.mobMax = m.hp + extra;
    state.mobHp = state.mobMax;
    mobName.textContent = m.name;
    mobEmoji.textContent = m.emoji;

    // ì£¼ì¸ê³µ ì•½ê°„ íšŒë³µ(ì´ˆë“±ìš©ìœ¼ë¡œ ë„ˆë¬´ ë¹¡ì„¸ì§€ ì•Šê²Œ)
    state.heroHp = clamp(state.heroHp + 18, 0, state.heroMax);

    // ë¬¸ì œ ë¦¬ì…‹
    state.remain = 5;
    remainTxt.textContent = state.remain;

    log(`â¡ï¸ ë‹¤ìŒ ìŠ¤í…Œì´ì§€! ${m.name} ë“±ì¥ (HP ${state.mobMax})`);
    setBars();

    // ìŠ¤í…Œì´ì§€ ë ì¡°ê±´(ì˜ˆ: 6ìŠ¤í…Œì´ì§€ì—ì„œ ìŠ¹ë¦¬)
    if(state.stage >= 6){
      gameOver(true);
      return;
    }

    // ìƒˆ ë¬¸ì œ ì‹œì‘
    state.current = generateQuestion();
    question.textContent = state.current.q;
    startTimer();
  }

  function resetAll(){
    stopTimer();
    state.stage = 1;
    state.heroHp = 100;
    state.heroMax = 100;
    state.score = 0;
    state.streak = 0;
    state.remain = 5;

    // ë‚œì´ë„/ì—°ì‚° ëª¨ë“œ ì ìš©
    state.difficulty = difficultySel.value;
    state.ops = opsSel.value;

    stageTag.textContent = `ìŠ¤í…Œì´ì§€ ${state.stage}`;
    const m = mobs[0];
    state.mobMax = m.hp;
    state.mobHp = state.mobMax;
    mobName.textContent = m.name;
    mobEmoji.textContent = m.emoji;

    // í…ìŠ¤íŠ¸
    heroState.textContent = 'ì¤€ë¹„!';
    mobState.textContent = 'ë¤ë²¼!';
    logEl.innerHTML = '';
    log('ê²Œì„ ì‹œì‘!');

    diffTxt.textContent =
      state.difficulty === 'easy' ? 'ì‰¬ì›€' :
      state.difficulty === 'normal' ? 'ë³´í†µ' : 'ì–´ë ¤ì›€';

    scoreEl.textContent = state.score;
    streakEl.textContent = state.streak;
    remainTxt.textContent = state.remain;

    // ì…ë ¥ í™œì„±í™”
    attackBtn.disabled = false;
    ans.disabled = false;

    setBars();

    // ì²« ë¬¸ì œ
    state.current = generateQuestion();
    question.textContent = state.current.q;
    ans.value = '';
    ans.focus();
    startTimer();
  }

  // ---------- ì´ë²¤íŠ¸ ----------
  function submit(){
    if(!state.current) return;
    const v = ans.value.trim();
    if(v === ''){
      onWrong('ì…ë ¥ ì•ˆ í•¨!');
      return;
    }
    stopTimer();
    const num = Number(v);
    if(Number.isNaN(num)){
      onWrong('ìˆ«ìê°€ ì•„ë‹˜!');
      return;
    }
    if(num === state.current.a) onCorrect();
    else onWrong('ì˜¤ë‹µ!');
  }

  attackBtn.addEventListener('click', submit);
  ans.addEventListener('keydown', (e) => {
    if(e.key === 'Enter') submit();
  });

  resetBtn.addEventListener('click', resetAll);
  difficultySel.addEventListener('change', resetAll);
  opsSel.addEventListener('change', resetAll);

  // ì‹œì‘
  resetAll();
})();
</script>
</body>
</html>