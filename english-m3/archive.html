<!-- archive.html -->
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VAREM · Archive</title>

<style>
body{
  margin:0; min-height:100vh; background:#0f0f10; color:#fff;
  font-family: system-ui,-apple-system,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
  display:flex; justify-content:center;
}
.wrap{ width:min(560px,92vw); padding:32px 0; }

.brand{
  text-align:center; letter-spacing:.28em; font-weight:700; font-size:14px;
  opacity:.7; margin-bottom:14px;
}

.header{
  display:flex; justify-content:space-between; align-items:flex-end;
  margin-bottom:12px;
}
.title{ font-size:14px; opacity:.75; }
.back{
  font-size:12px; border:1px solid rgba(255,255,255,.18);
  padding:6px 10px; border-radius:999px; cursor:pointer; opacity:.75; user-select:none;
}

.panel{
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px; overflow:hidden;
  background:rgba(255,255,255,.02);
}

/* 목록 5개 높이 + 스크롤 */
.list{
  max-height: 270px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}

.row{
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 16px;
  border-top:1px solid rgba(255,255,255,.08);
  cursor:pointer;
}
.row:first-child{ border-top:none; }
.row:hover{ background:rgba(255,255,255,.03); }

.day{ font-size:12px; opacity:.6; }
.word{ font-size:16px; font-weight:700; }

/* 상세 */
.detail{
  border-top:1px solid rgba(255,255,255,.10);
  padding:18px 16px 18px;
  display:none;
}
.detailTop{
  display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
}
.detailTitle{ font-size:14px; opacity:.75; }
.detailDay{
  font-size:12px; border:1px solid rgba(255,255,255,.18);
  border-radius:999px; padding:6px 10px; opacity:.75; white-space:nowrap;
}
.bigWord{ margin-top:10px; font-size:38px; font-weight:800; }

.meta{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; }
.pill{
  border:1px solid rgba(255,255,255,.18);
  border-radius:999px; padding:6px 10px; font-size:12px; opacity:.75;
}
.lang{
  border:1px solid rgba(255,255,255,.18);
  background:none; color:#fff; padding:6px 10px; border-radius:999px;
  font-size:12px; opacity:.45; cursor:pointer;
}
.lang.active{ opacity:1; border-color:rgba(255,255,255,.6); }

.voiceBtn{
  border:1px solid rgba(255,255,255,.18);
  background:none; color:#fff;
  padding:6px 10px; border-radius:999px;
  font-size:12px; letter-spacing:.08em;
  opacity:.45; cursor:pointer;
  transition: all .2s ease;
}
.voiceBtn:hover{ opacity:.75; }
.voiceBtn:active{ transform:scale(.96); }
.voiceBtn.playing{
  opacity:1;
  border-color:rgba(255,255,255,.55);
  box-shadow:0 0 0 3px rgba(255,255,255,.06);
}

.meaning{ margin-top:16px; font-size:18px; line-height:1.6; }
.example{ margin-top:10px; font-size:16px; opacity:.88; line-height:1.6; }
.hint{ margin-top:10px; font-size:12px; opacity:.35; }
</style>

<!-- ✅ data 로더 -->
<script src="data/data.js"></script>
</head>

<body>
<div class="wrap">
  <div class="brand">VAREM</div>

  <div class="header">
    <div class="title">Archive · Day 1 ~ 어제</div>
    <div class="back" onclick="location.href='./'">← Today</div>
  </div>

  <div class="panel">
    <div class="list" id="list"></div>

    <div class="detail" id="detail">
      <div class="detailTop">
        <div class="detailTitle">아카이브</div>
        <div class="detailDay" id="dDay">Day -</div>
      </div>

      <div class="bigWord" id="dWord">word</div>

      <div class="meta">
        <div class="pill" id="dPos">POS</div>

        <button class="lang active" id="btnEN" type="button">English</button>

        <button class="voiceBtn" id="btnSpeak" type="button" aria-label="voice">voice</button>

        <button class="lang" id="btnKO" type="button">Korean</button>
      </div>

      <div class="meaning" id="dMeaning"></div>
      <div class="example" id="dExample"></div>
      <div class="hint">목록에서 다른 Day를 눌러 바꿀 수 있어요.</div>
    </div>
  </div>
</div>

<script>
function kst(){
  const n=new Date();
  return new Date(n.getTime()+n.getTimezoneOffset()*60000+9*3600000);
}
function dayOfYear(d){
  return Math.floor((d-new Date(d.getFullYear(),0,1))/86400000);
}

let LIST = [];
let todayIndex = 0; // 0-based (오늘)

const listEl = document.getElementById("list");
const detailEl = document.getElementById("detail");

let currentIndex = null; // 0-based day index
let mode = "EN";

function itemForDayIndex(i){
  return LIST.length ? LIST[i % LIST.length] : null;
}

function renderList(){
  listEl.innerHTML = "";

  if(todayIndex <= 0 || !LIST.length){
    const row = document.createElement("div");
    row.className = "row";
    row.style.cursor = "default";
    row.innerHTML = `<div class="day">No archive yet</div><div class="word"></div>`;
    listEl.appendChild(row);
    return;
  }

  for(let i = todayIndex - 1; i >= 0; i--){
    const dayNum = i + 1;
    const it = itemForDayIndex(i);
    const w = (it?.word || it?.w || "").toLowerCase();

    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `<div class="day">Day ${dayNum}</div><div class="word">${w}</div>`;
    row.onclick = () => showDetail(i);
    listEl.appendChild(row);
  }
}

function renderDetail(){
  if(currentIndex === null) return;
  const it = itemForDayIndex(currentIndex);
  if(!it) return;

  const w = (it.word || it.w || "").toLowerCase();
  const p = (it.pos || it.p || "");

  dDay.innerText = "Day " + (currentIndex + 1);
  dWord.innerText = w;
  dPos.innerText = p;

  if(mode === "EN"){
    dMeaning.innerText = "Meaning: " + (it.meaning_en ?? it.m_en ?? it.meaning_ko ?? it.m_ko ?? "");
    dExample.innerText = "Example: " + (it.example_en ?? it.e_en ?? it.example_ko ?? it.e_ko ?? "");
  }else{
    dMeaning.innerText = "뜻: " + (it.meaning_ko ?? it.m_ko ?? it.meaning_en ?? it.m_en ?? "");
    dExample.innerText = "예문: " + (it.example_ko ?? it.e_ko ?? it.example_en ?? it.e_en ?? "");
  }

  btnEN.classList.toggle("active", mode==="EN");
  btnKO.classList.toggle("active", mode==="KO");
}

function showDetail(dayIndex){
  currentIndex = dayIndex;
  mode = "EN";
  detailEl.style.display = "block";
  renderDetail();
  detailEl.scrollIntoView({behavior:"smooth", block:"start"});
}

btnEN.onclick = () => { mode="EN"; renderDetail(); };
btnKO.onclick = () => { mode="KO"; renderDetail(); };

// ✅ voice(TTS)
function speakWord(text){
  try{
    if(!("speechSynthesis" in window)) return;

    window.speechSynthesis.cancel();

    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.95;

    u.onstart = () => btnSpeak.classList.add("playing");
    u.onend   = () => btnSpeak.classList.remove("playing");
    u.onerror = () => btnSpeak.classList.remove("playing");

    const voices = window.speechSynthesis.getVoices?.() || [];
    const v = voices.find(v=>/en-US/i.test(v.lang)) || voices.find(v=>/^en/i.test(v.lang));
    if(v) u.voice = v;

    window.speechSynthesis.speak(u);
  }catch(e){
    btnSpeak.classList.remove("playing");
  }
}
if("speechSynthesis" in window){
  window.speechSynthesis.onvoiceschanged = ()=>{};
}
btnSpeak.onclick = () => {
  if(currentIndex !== null){
    const it = itemForDayIndex(currentIndex);
    const w = (it?.word || it?.w || "");
    if(w) speakWord(w);
  }
};

// ✅ data 로드 완료 후 렌더
window.VAREM_onReady(function(){
  LIST = window.VAREM_LIST || [];
  todayIndex = dayOfYear(kst());
  renderList();
});
</script>
</body>
</html>