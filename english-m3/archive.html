<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VAREM · Archive</title>

<style>
body{
  margin:0; min-height:100vh; background:#0f0f10; color:#fff;
  font-family: system-ui,-apple-system,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
  display:flex; justify-content:center;
}
.wrap{ width:min(560px,92vw); padding:32px 0; }

.brand{
  text-align:center; letter-spacing:.28em; font-weight:700; font-size:14px;
  opacity:.7; margin-bottom:14px;
}

.header{
  display:flex; justify-content:space-between; align-items:flex-end;
  margin-bottom:12px;
}
.title{ font-size:14px; opacity:.75; }
.back{
  font-size:12px; border:1px solid rgba(255,255,255,.18);
  padding:6px 10px; border-radius:999px; cursor:pointer; opacity:.75; user-select:none;
}

.panel{
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px; overflow:hidden;
  background:rgba(255,255,255,.02);
}

.list{
  max-height: 270px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}

.row{
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 16px;
  border-top:1px solid rgba(255,255,255,.08);
  cursor:pointer;
}
.row:first-child{ border-top:none; }
.row:hover{ background:rgba(255,255,255,.03); }

.day{ font-size:12px; opacity:.6; }
.word{ font-size:16px; font-weight:700; }

.detail{
  border-top:1px solid rgba(255,255,255,.10);
  padding:18px 16px 18px;
  display:none;
}
.detailTop{
  display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
}
.detailTitle{ font-size:14px; opacity:.75; }
.detailDay{
  font-size:12px; border:1px solid rgba(255,255,255,.18);
  border-radius:999px; padding:6px 10px; opacity:.75; white-space:nowrap;
}
.bigWord{ margin-top:10px; font-size:38px; font-weight:800; }

.meta{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; }
.pill{
  border:1px solid rgba(255,255,255,.18);
  border-radius:999px; padding:6px 10px; font-size:12px; opacity:.75;
}
.lang{
  border:1px solid rgba(255,255,255,.18);
  background:none; color:#fff; padding:6px 10px; border-radius:999px;
  font-size:12px; opacity:.45; cursor:pointer;
}
.lang.active{ opacity:1; border-color:rgba(255,255,255,.6); }

.meaning{ margin-top:16px; font-size:18px; line-height:1.6; }
.example{ margin-top:10px; font-size:16px; opacity:.88; line-height:1.6; }
.hint{ margin-top:10px; font-size:12px; opacity:.35; }
</style>
</head>

<body>
<div class="wrap">
  <div class="brand">VAREM</div>

  <div class="header">
    <div class="title">Archive · Day 1 ~ 어제</div>
    <div class="back" onclick="location.href='./'">← Today</div>
  </div>

  <div class="panel">
    <div class="list" id="list"></div>

    <div class="detail" id="detail">
      <div class="detailTop">
        <div class="detailTitle">중3 영어 · 아카이브</div>
        <div class="detailDay" id="dDay">Day -</div>
      </div>

      <div class="bigWord" id="dWord">word</div>

      <div class="meta">
        <div class="pill" id="dPos">POS</div>
        <div class="pill">M3</div>
        <button class="lang active" id="btnEN" type="button">English</button>
        <button class="lang" id="btnKO" type="button">Korean</button>
      </div>

      <div class="meaning" id="dMeaning"></div>
      <div class="example" id="dExample"></div>
      <div class="hint">목록에서 다른 Day를 눌러 바꿀 수 있어요.</div>
    </div>
  </div>
</div>

<script src="data/data.js"></script>

<script>
function kstTodayMidnight(){
  const now = new Date();
  const kst = new Date(now.getTime() + now.getTimezoneOffset()*60000 + 9*3600000);
  return new Date(kst.getFullYear(), kst.getMonth(), kst.getDate());
}
function kstDayOfYearIndex(){
  const t = kstTodayMidnight();
  const y0 = new Date(t.getFullYear(), 0, 1);
  return Math.floor((t - y0) / 86400000); // 0-based
}

const listEl = document.getElementById("list");
const detailEl = document.getElementById("detail");

let currentIndex = null; // 0-based
let mode = "EN";

function itemForDayIndex(i){
  const LIST = window.VAREM_LIST || [];
  if(!LIST.length) return null;
  const idx = ((i % LIST.length) + LIST.length) % LIST.length;
  return LIST[idx];
}

function renderList(){
  const LIST = window.VAREM_LIST || [];
  listEl.innerHTML = "";

  if(!LIST.length){
    const row = document.createElement("div");
    row.className = "row";
    row.style.cursor = "default";
    row.innerHTML = `<div class="day">Loading...</div><div class="word"></div>`;
    listEl.appendChild(row);
    return;
  }

  const todayIndex = kstDayOfYearIndex();

  if(todayIndex <= 0){
    const row = document.createElement("div");
    row.className = "row";
    row.style.cursor = "default";
    row.innerHTML = `<div class="day">No archive yet</div><div class="word"></div>`;
    listEl.appendChild(row);
    return;
  }

  for(let i = todayIndex - 1; i >= 0; i--){
    const it = itemForDayIndex(i);
    const dayNum = i + 1;

    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `<div class="day">Day ${dayNum}</div><div class="word">${(it?.w||"").toLowerCase()}</div>`;
    row.onclick = () => showDetail(i);
    listEl.appendChild(row);
  }
}

function renderDetail(){
  if(currentIndex === null) return;
  const it = itemForDayIndex(currentIndex);
  if(!it) return;

  dDay.innerText = "Day " + (currentIndex + 1);
  dWord.innerText = (it.w || "").toLowerCase();
  dPos.innerText = it.p || "";

  if(mode === "EN"){
    dMeaning.innerText = "Meaning: " + (it.m_en ?? it.m_ko ?? "");
    dExample.innerText = "Example: " + (it.e_en ?? it.e_ko ?? "");
  }else{
    dMeaning.innerText = "뜻: " + (it.m_ko ?? it.m_en ?? "");
    dExample.innerText = "예문: " + (it.e_ko ?? it.e_en ?? "");
  }

  btnEN.classList.toggle("active", mode==="EN");
  btnKO.classList.toggle("active", mode==="KO");
}

function showDetail(dayIndex){
  currentIndex = dayIndex;
  mode = "EN";
  detailEl.style.display = "block";
  renderDetail();
  detailEl.scrollIntoView({behavior:"smooth", block:"start"});
}

btnEN.onclick = () => { mode="EN"; renderDetail(); };
btnKO.onclick = () => { mode="KO"; renderDetail(); };

window.VAREM_onReady(() => {
  renderList();
});
renderList();
</script>
</body>
</html>