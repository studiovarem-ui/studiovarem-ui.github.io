<!doctype html>

<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VAREM · Archive</title>

<style>
body{
  margin:0; min-height:100vh;
  background:#0f0f10; color:#fff;
  font-family: system-ui,-apple-system,Apple SD Gothic Neo,Noto Sans KR,sans-serif;
}
.wrap{
  width:min(720px,94vw);
  margin:0 auto;
  padding:36px 0 40px;
}
.brand{
  text-align:center;
  letter-spacing:.28em;
  font-weight:700;
  font-size:14px;
  opacity:.7;
  margin-bottom:18px;
}
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:18px;
}
.title{
  font-size:20px;
  font-weight:700;
}
.back{
  font-size:12px;
  opacity:.6;
  text-decoration:none;
  color:#fff;
}
.back:hover{opacity:1}

/* 리스트 */
.list{
  display:flex;
  flex-direction:column;
  gap:1px;
}

.row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:16px 16px;
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
  cursor:pointer;
  transition:all .15s ease;
}
.row:hover{
  border-color:rgba(255,255,255,.25);
}
.row.active{
  border-color:rgba(255,255,255,.3);
  background:rgba(255,255,255,.04);
  border-radius:12px 12px 0 0;
}
.row-left{
  display:flex;
  align-items:center;
  gap:14px;
}
.row-day{
  font-size:11px;
  opacity:.4;
  min-width:46px;
}
.row-word{
  font-size:16px;
  font-weight:700;
}
.row-pos{
  font-size:11px;
  opacity:.35;
}

/* 상세 패널 */
.detail{
  overflow:hidden;
  max-height:0;
  transition:max-height .3s ease;
}
.detail.open{
  max-height:400px;
}
.detail-inner{
  padding:20px 16px 24px;
  border:1px solid rgba(255,255,255,.08);
  border-top:none;
  border-radius:0 0 12px 12px;
  background:rgba(255,255,255,.02);
  margin-top:-1px;
}
.detail-word{
  font-size:28px;
  font-weight:700;
  margin-bottom:6px;
}
.detail-pos{
  display:inline-block;
  font-size:11px;
  opacity:.5;
  border:1px solid rgba(255,255,255,.15);
  padding:3px 10px;
  border-radius:20px;
  margin-bottom:16px;
}
.detail-section{
  margin-bottom:14px;
}
.detail-label{
  font-size:10px;
  opacity:.35;
  letter-spacing:.1em;
  text-transform:uppercase;
  margin-bottom:4px;
}
.detail-text{
  font-size:14px;
  line-height:1.5;
  opacity:.85;
}
.detail-example{
  font-size:13px;
  line-height:1.5;
  opacity:.55;
  font-style:italic;
}
.detail-top{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:6px;
}
.voiceBtn{
  border:1px solid rgba(255,255,255,.18);
  background:none; color:#fff;
  padding:5px 10px; border-radius:999px;
  font-size:11px; letter-spacing:.08em;
  opacity:.45; cursor:pointer;
  transition:all .2s ease;
  flex-shrink:0;
}
.voiceBtn:hover{ opacity:.75; }
.voiceBtn:active{ transform:scale(.96); }
.voiceBtn.playing{
  opacity:1;
  border-color:rgba(255,255,255,.55);
  box-shadow:0 0 0 3px rgba(255,255,255,.06);
}
</style>

<script src="data/data.js"></script>

</head>

<body>
<div class="wrap">
  <div class="brand">VAREM</div>

  <div class="header">
    <div class="title">Archive</div>
    <a class="back" href="index.html">← Today</a>
  </div>

  <div class="list" id="list"></div>
</div>

<script>
// TTS
function speakWord(text, btn){
  try{
    if(!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.95;
    if(btn){
      u.onstart = () => btn.classList.add("playing");
      u.onend   = () => btn.classList.remove("playing");
      u.onerror = () => btn.classList.remove("playing");
    }
    const voices = window.speechSynthesis.getVoices?.() || [];
    const v = voices.find(v=>/en-US/i.test(v.lang)) || voices.find(v=>/^en/i.test(v.lang));
    if(v) u.voice = v;
    window.speechSynthesis.speak(u);
  }catch(e){
    if(btn) btn.classList.remove("playing");
  }
}
if("speechSynthesis" in window){
  window.speechSynthesis.onvoiceschanged = ()=>{};
}

window.VAREM_onReady(function(){
  const listEl = document.getElementById("list");
  const data = window.VAREM_LIST || [];

  // 오늘 Day 계산
  const now = new Date();
  const jan1 = new Date(now.getFullYear(), 0, 1);
  const today = Math.floor((now - jan1) / 86400000) + 1;

  // 오늘까지 필터 + 최신순
  const filtered = data.filter(item => (item.day || 0) <= today);
  filtered.sort((a, b) => b.day - a.day);

  let openRow = null;
  let openRowEl = null;

  filtered.forEach((item) => {
    const w = item.word || item.w || "";
    const pos = item.p || "";
    const mEn = item.meaning_en || item.m_en || "";
    const mKo = item.meaning_ko || item.m_ko || "";
    const eEn = item.example_en || item.e_en || "";
    const eKo = item.example_ko || item.e_ko || "";

    // 행
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <div class="row-left">
        <div class="row-day">Day ${item.day}</div>
        <div class="row-word">${w.toLowerCase()}</div>
      </div>
      <div class="row-pos">${pos}</div>
    `;

    // 상세 패널
    const detail = document.createElement("div");
    detail.className = "detail";
    detail.innerHTML = `
      <div class="detail-inner">
        <div class="detail-top">
          <div class="detail-word">${w.toLowerCase()}</div>
          <button class="voiceBtn" type="button" data-word="${w}" aria-label="voice">voice</button>
        </div>
        <div class="detail-pos">${pos}</div>
        <div class="detail-section">
          <div class="detail-label">meaning</div>
          <div class="detail-text">${mEn}</div>
          <div class="detail-text" style="opacity:.55">${mKo}</div>
        </div>
        ${eEn ? `<div class="detail-section">
          <div class="detail-label">example</div>
          <div class="detail-example">${eEn}</div>
          <div class="detail-example">${eKo}</div>
        </div>` : ""}
      </div>
    `;

    // voice 버튼 클릭 (이벤트 버블링 막기)
    const vBtn = detail.querySelector(".voiceBtn");
    if (vBtn) {
      vBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        speakWord(vBtn.dataset.word, vBtn);
      });
    }

    row.addEventListener("click", () => {
      // 이전 열린 거 닫기
      if (openRow && openRow !== detail) {
        openRow.classList.remove("open");
        openRowEl.classList.remove("active");
      }
      const isOpen = detail.classList.toggle("open");
      row.classList.toggle("active", isOpen);
      openRow = isOpen ? detail : null;
      openRowEl = isOpen ? row : null;
    });

    listEl.appendChild(row);
    listEl.appendChild(detail);
  });
});
</script>

</body>
</html>