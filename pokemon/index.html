<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>POKÉMON RANDOM GAME</title>

  <style>
    :root{
      --bg:#ffffff;             /* ✅ 전체 배경 흰색 */
      --fg:#0f172a;
      --muted:rgba(15,23,42,.55);
      --line:rgba(15,23,42,.10);
      --accent:#557CF3;
    }

    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      background: var(--bg);
      color:var(--fg);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      overflow:hidden;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }

    .frame{
      width:min(560px, 94vw);
      padding:22px 18px;
      border:1px solid var(--line);
      border-radius:18px;
      background:#fff;
      box-shadow: 0 18px 50px rgba(15,23,42,.12);
      position:relative;
      overflow:hidden;
    }

    .brand{
      letter-spacing:.38em;
      font-weight:900;
      font-size:12px;
      opacity:.7;
    }

    .screen{
      display:none;
      min-height:520px;
      padding:18px 10px 10px;
      position:relative;
    }
    .screen.active{display:block}

    .title{
      margin:18px 0 6px;
      font-size:28px;
      line-height:1.1;
      letter-spacing:.08em;
      text-transform:uppercase;
      text-shadow: 0 0 18px rgba(85,124,243,.10);
    }
    .subtitle{
      margin:0 0 18px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.16em;
      text-transform:uppercase;
    }

    .center{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      min-height:420px;
      text-align:center;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:14px 22px;
      border-radius:14px;
      border:1px solid rgba(85,124,243,.55);
      background: rgba(85,124,243,.10);
      color:var(--fg);
      font-weight:900;
      letter-spacing:.18em;
      text-transform:uppercase;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .12s ease;
    }
    .btn:active{
      transform: translateY(1px) scale(.99);
      box-shadow: 0 0 28px rgba(85,124,243,.18);
    }

    .blink{ animation: blink 1.1s steps(2,end) infinite; }
    @keyframes blink{ 50%{opacity:.25} }

    .foot{
      margin-top:10px;
      color:var(--muted);
      font-size:11px;
      letter-spacing:.08em;
      line-height:1.5;
    }

    /* toast */
    .toast{
      position:absolute;
      top:14px;
      left:50%;
      transform: translateX(-50%);
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.92);
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      opacity:0;
      transition: opacity .18s ease;
      pointer-events:none;
      box-shadow: 0 12px 30px rgba(15,23,42,.10);
    }
    .toast.on{ opacity:1; }

    /* Screen 2: roulette (빠르게 돌다가 탭하면 선택) */
    .roulette-wrap{
      width:100%;
      height:420px;
      border-radius:18px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,.03);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
      position:relative;
      overflow:hidden;
      touch-action: manipulation;
    }
    .roulette-title{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.16em;
      text-transform:uppercase;
    }
    .roulette-ball{
      width:180px;
      height:180px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      filter: drop-shadow(0 14px 18px rgba(15,23,42,.12));
      transform: translateZ(0);
    }
    .roulette-ball img{
      width:100%;
      height:auto;
      user-select:none;
      -webkit-user-drag:none;
    }
    .roulette-ring{
      position:absolute;
      inset:-24px;
      border-radius:999px;
      border:1px solid rgba(85,124,243,.22);
      animation: spin 1.1s linear infinite;
      opacity:.9;
      pointer-events:none;
    }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    .tap-anywhere{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.14em;
      text-transform:uppercase;
    }

    .row{
      display:flex;
      gap:10px;
      justify-content:center;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .mini{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.92);
      color:var(--fg);
      font-weight:900;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(15,23,42,.08);
    }
    .mini:active{ transform: translateY(1px); }

    /* Screen 3 throw area */
    .throw-area{
      width:100%;
      height:420px;
      border-radius:18px;
      border:1px dashed rgba(15,23,42,.18);
      background:#fff;
      position:relative;
      overflow:hidden;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding-bottom:26px;
      touch-action:none;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,.03);
    }
    .throw-ball{
      width:120px;
      height:120px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:absolute;
      bottom:26px;
      left:50%;
      transform: translateX(-50%);
      transition: transform .1s ease;
      will-change: transform;
    }
    .throw-ball img{
      width:100%;
      height:auto;
      filter: drop-shadow(0 14px 16px rgba(15,23,42,.16));
      user-select:none;
      -webkit-user-drag:none;
    }

    /* Screen 4 capture */
    .capture-stage{
      width:100%;
      height:420px;
      border-radius:18px;
      border:1px solid var(--line);
      background:#fff;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,.03);
    }
    .orbit{
      position:absolute;
      width:240px;
      height:240px;
      border-radius:999px;
      border:1px solid rgba(85,124,243,.20);
      animation: spin 1.1s linear infinite;
      opacity:.9;
    }
    .cap-ball{
      width:140px;
      height:140px;
      display:flex;
      align-items:center;
      justify-content:center;
      animation: wobble .36s ease-in-out infinite;
      filter: drop-shadow(0 16px 18px rgba(15,23,42,.18));
    }
    @keyframes wobble{
      0%,100%{ transform: rotate(-6deg) }
      50%{ transform: rotate(6deg) }
    }
    .cap-ball img{ width:100%; height:auto; user-select:none; -webkit-user-drag:none; }

    .count{
      position:absolute;
      top:18px;
      right:18px;
      font-size:42px;
      font-weight:900;
      letter-spacing:.08em;
      text-shadow: 0 0 18px rgba(85,124,243,.12);
    }

    /* Screen 5 reveal */
    .reveal{
      width:100%;
      height:420px;
      border-radius:18px;
      border:1px solid var(--line);
      background:#fff;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,.03);
    }
    .flash{
      position:absolute; inset:-40%;
      background: radial-gradient(circle, rgba(85,124,243,.22), transparent 55%);
      opacity:0;
      transform: scale(.85);
      transition: opacity .18s ease, transform .18s ease;
      pointer-events:none;
    }
    .flash.on{
      opacity:1;
      transform: scale(1.05);
    }
    .poke{
      width:min(320px, 70vw);
      height:auto;
      filter: drop-shadow(0 18px 24px rgba(15,23,42,.18));
      transform: translateY(6px) scale(.98);
      opacity:0;
      transition: opacity .22s ease, transform .22s ease;
      user-select:none;
      -webkit-user-drag:none;
    }
    .poke.show{
      opacity:1;
      transform: translateY(0) scale(1);
    }

    .gotcha{
      position:absolute;
      bottom:16px;
      left:50%;
      transform: translateX(-50%);
      font-size:26px;
      font-weight:900;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#0f172a;
      text-shadow: 0 0 18px rgba(85,124,243,.10);
    }
  </style>
</head>

<body>
  <div class="frame">
    <div class="brand">VAREM</div>
    <div id="toast" class="toast">READY</div>

    <!-- Screen 1 -->
    <section id="s1" class="screen active">
      <div class="center">
        <div>
          <div class="title">POKÉMON<br/>RANDOM GAME</div>
          <div class="subtitle blink">press start</div>
        </div>
        <button id="startBtn" class="btn">START</button>
        <div class="foot">
          * 배경은 완전 흰색(#fff)<br/>
          * 볼은 룰렛처럼 빠르게 돌다가 탭하면 랜덤 선택
        </div>
      </div>
    </section>

    <!-- Screen 2 (Roulette) -->
    <section id="s2" class="screen">
      <div class="center" style="gap:10px;">
        <div class="title" style="font-size:18px;margin:8px 0 0;">CHOOSE ONE!</div>
        <div class="subtitle" id="s2Sub">starting roulette…</div>

        <div id="rouletteWrap" class="roulette-wrap" aria-label="Ball Roulette">
          <div class="roulette-title">balls are spinning…</div>

          <div class="roulette-ball" id="rouletteBall">
            <div class="roulette-ring"></div>
            <img id="rouletteImg" alt="ball" src="images/Poke_ball.png" />
          </div>

          <div class="tap-anywhere blink">tap anywhere to stop</div>
        </div>

        <div class="row">
          <button id="back1" class="mini">BACK</button>
        </div>
      </div>
    </section>

    <!-- Screen 3 -->
    <section id="s3" class="screen">
      <div class="center" style="gap:10px;">
        <div class="title" style="font-size:18px;margin:8px 0 0;">SWIPE UP!</div>
        <div class="subtitle">throw the ball</div>

        <div id="throwArea" class="throw-area">
          <div id="throwBall" class="throw-ball">
            <img id="throwBallImg" alt="ball" src="images/Poke_ball.png" />
          </div>
        </div>

        <div class="row">
          <button id="restart" class="mini">RESTART</button>
        </div>
      </div>
    </section>

    <!-- Screen 4 -->
    <section id="s4" class="screen">
      <div class="center" style="gap:10px;">
        <div class="title" style="font-size:18px;margin:8px 0 0;">CATCHING…</div>
        <div class="subtitle">3, 2, 1</div>

        <div class="capture-stage">
          <div class="orbit"></div>
          <div class="orbit" style="width:320px;height:320px;opacity:.45;animation-duration:1.6s"></div>
          <div class="cap-ball">
            <img id="capBallImg" alt="ball" src="images/Poke_ball.png" />
          </div>
          <div id="count" class="count">3</div>
        </div>
      </div>
    </section>

    <!-- Screen 5 -->
    <section id="s5" class="screen">
      <div class="center" style="gap:10px;">
        <div class="title" style="font-size:18px;margin:8px 0 0;">RESULT</div>
        <div class="subtitle">random reveal</div>

        <div class="reveal">
          <div id="flash" class="flash"></div>
          <img id="pokeImg" class="poke" alt="pokemon" src="" />
          <div class="gotcha">GOTCHA!</div>
        </div>

        <div class="row">
          <button id="again" class="mini">AGAIN</button>
          <button id="home" class="mini">HOME</button>
        </div>
      </div>
    </section>
  </div>

  <script>
    /***********************
     * ✅ 네 파일명/요구사항 반영
     * 1) 배경: 흰색
     * 2) 볼 선택: 순서대로 빠르게 바뀌는 "룰렛" -> 탭하면 그 순간의 볼로 선택(랜덤 느낌)
     * 3) 포켓몬: poke_01 ~ poke_30 자동
     ************************/

    // ✅ 포켓몬 01~30 자동 생성
    const pokemonList = [];
    for (let i = 1; i <= 30; i++) {
      pokemonList.push(`images/poke_${String(i).padStart(2, "0")}.png`);
    }

    const CONFIG = {
      balls: [
        "images/Beast_ball.png",
        "images/Fast_ball.png",
        "images/Net_ball.png",
        "images/Great_ball.png",
        "images/Master_ball.png",
        "images/Poke_ball.png",
        "images/Ultra_ball.png",
      ],
      pokemons: pokemonList,

      // 룰렛 속도 (숫자 작을수록 더 빠름)
      rouletteIntervalMs: 80,

      // 시작 후 2초 지나면 룰렛 시작(네가 원한 2초 느낌)
      rouletteStartDelayMs: 600,

      countdownMs: 900
    };

    const $ = (sel) => document.querySelector(sel);

    const screens = ["#s1", "#s2", "#s3", "#s4", "#s5"].map(s => $(s));
    const toast = $("#toast");

    const startBtn = $("#startBtn");
    const back1 = $("#back1");
    const restart = $("#restart");
    const again = $("#again");
    const home = $("#home");

    const s2Sub = $("#s2Sub");
    const rouletteWrap = $("#rouletteWrap");
    const rouletteImg = $("#rouletteImg");

    const throwArea = $("#throwArea");
    const throwBall = $("#throwBall");
    const throwBallImg = $("#throwBallImg");
    const capBallImg = $("#capBallImg");
    const countEl = $("#count");

    const flash = $("#flash");
    const pokeImg = $("#pokeImg");

    let chosenBallSrc = "images/Poke_ball.png";
    let chosenPokemonSrc = "";

    // roulette state
    let rouletteTimer = null;
    let rouletteIndex = 0;
    let rouletteArmed = false;     // 탭 가능 상태
    let rouletteStartTimer = null;

    // swipe state
    let countdownTimer = null;
    let touch = { active:false, startY:0, startX:0, startT:0 };

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("on");
      setTimeout(()=>toast.classList.remove("on"), 700);
    }

    function go(n){
      screens.forEach((el,i)=> el.classList.toggle("active", i===n));
    }

    function pickRandom(arr){
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function resetAll(){
      chosenBallSrc = "images/Poke_ball.png";
      chosenPokemonSrc = "";

      // reset roulette
      stopRoulette();
      rouletteIndex = 0;
      rouletteImg.src = chosenBallSrc;
      s2Sub.textContent = "starting roulette…";

      // reset throw/capture imgs
      throwBallImg.src = chosenBallSrc;
      capBallImg.src = chosenBallSrc;

      // reset reveal
      flash.classList.remove("on");
      pokeImg.classList.remove("show");
      pokeImg.src = "";
    }

    /*************** Screen2 Roulette ***************/
    function startRoulette(){
      rouletteArmed = true;
      rouletteIndex = 0;

      rouletteTimer = setInterval(() => {
        rouletteIndex = (rouletteIndex + 1) % CONFIG.balls.length;
        rouletteImg.src = CONFIG.balls[rouletteIndex];
      }, CONFIG.rouletteIntervalMs);

      s2Sub.textContent = "tap to stop!";
      showToast("TAP!");
    }

    function stopRoulette(){
      rouletteArmed = false;
      if (rouletteTimer) clearInterval(rouletteTimer);
      rouletteTimer = null;
      if (rouletteStartTimer) clearTimeout(rouletteStartTimer);
      rouletteStartTimer = null;
    }

    function enterScreen2(){
      go(1);
      resetAll();

      // 약간 텀 준 뒤 룰렛 시작(연출)
      stopRoulette();
      s2Sub.textContent = "ready…";
      rouletteStartTimer = setTimeout(() => startRoulette(), CONFIG.rouletteStartDelayMs);
    }

    function onRouletteTap(){
      if (!rouletteArmed) return;

      // 그 순간의 볼이 선택됨(랜덤 느낌)
      chosenBallSrc = CONFIG.balls[rouletteIndex];
      stopRoulette();

      // 다음 화면에서 이 볼 사용
      throwBallImg.src = chosenBallSrc;
      capBallImg.src = chosenBallSrc;

      showToast("SELECTED!");
      go(2); // Screen3
    }

    rouletteWrap.addEventListener("click", onRouletteTap);

    /*************** Screen3 Swipe Throw ***************/
    function onTouchStart(e){
      if (e.touches && e.touches.length){
        touch.active = true;
        touch.startY = e.touches[0].clientY;
        touch.startX = e.touches[0].clientX;
        touch.startT = performance.now();
      }
    }
    function onTouchMove(e){
      if (!touch.active) return;
      const y = e.touches[0].clientY;
      const dy = Math.min(0, y - touch.startY);
      throwBall.style.transform = `translateX(-50%) translateY(${dy * 0.35}px)`;
      e.preventDefault();
    }
    function onTouchEnd(e){
      if (!touch.active) return;
      touch.active = false;

      const endT = performance.now();
      const dt = Math.max(1, endT - touch.startT);

      const ct = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      const endY = ct ? ct.clientY : touch.startY;
      const dyTotal = endY - touch.startY;

      throwBall.style.transform = `translateX(-50%)`;

      // 위로 70px 이상 스와이프
      if (dyTotal < -70){
        const speed = Math.min(1.6, Math.max(0.6, (-dyTotal) / dt * 2.2));
        animateThrow(speed);
      } else {
        showToast("SWIPE UP!");
      }
    }

    function animateThrow(speed){
      throwBall.style.transition = "transform .38s ease";
      const up = -380 * speed;
      const scale = 0.42;
      throwBall.style.transform = `translateX(-50%) translateY(${up}px) scale(${scale}) rotate(${220*speed}deg)`;

      showToast("THROW!");
      setTimeout(() => {
        throwBall.style.transition = "transform .1s ease";
        throwBall.style.transform = `translateX(-50%)`;
        enterScreen4();
      }, 420);
    }

    /*************** Screen4 Countdown ***************/
    function enterScreen4(){
      go(3);
      countEl.textContent = "3";
      clearInterval(countdownTimer);

      let n = 3;
      countdownTimer = setInterval(() => {
        n--;
        countEl.textContent = String(n);
        if (n <= 0){
          clearInterval(countdownTimer);
          enterScreen5();
        }
      }, CONFIG.countdownMs);
    }

    /*************** Screen5 Reveal ***************/
    function enterScreen5(){
      go(4);
      chosenPokemonSrc = pickRandom(CONFIG.pokemons);

      flash.classList.add("on");
      setTimeout(() => flash.classList.remove("on"), 220);

      pokeImg.src = chosenPokemonSrc;
      pokeImg.onerror = () => {
        showToast("IMG NOT FOUND");
      };

      setTimeout(() => {
        pokeImg.classList.add("show");
        showToast("GOTCHA!");
      }, 120);
    }

    /*************** Buttons ***************/
    startBtn.addEventListener("click", () => { showToast("START!"); enterScreen2(); });
    back1.addEventListener("click", () => { stopRoulette(); go(0); });
    restart.addEventListener("click", () => { showToast("RESTART"); enterScreen2(); });
    again.addEventListener("click", () => { showToast("AGAIN"); enterScreen2(); });
    home.addEventListener("click", () => { showToast("HOME"); stopRoulette(); go(0); });

    /*************** Swipe listeners ***************/
    throwArea.addEventListener("touchstart", onTouchStart, {passive:false});
    throwArea.addEventListener("touchmove", onTouchMove, {passive:false});
    throwArea.addEventListener("touchend", onTouchEnd, {passive:true});

    // desktop test (mouse)
    let mouseDown = false;
    throwArea.addEventListener("mousedown", (e)=>{
      mouseDown = true;
      touch.active = true;
      touch.startY = e.clientY;
      touch.startX = e.clientX;
      touch.startT = performance.now();
    });
    window.addEventListener("mousemove", (e)=>{
      if (!mouseDown || !touch.active) return;
      const dy = Math.min(0, e.clientY - touch.startY);
      throwBall.style.transform = `translateX(-50%) translateY(${dy * 0.35}px)`;
    });
    window.addEventListener("mouseup", (e)=>{
      if (!mouseDown) return;
      mouseDown = false;
      const endT = performance.now();
      const dt = Math.max(1, endT - touch.startT);
      const dyTotal = e.clientY - touch.startY;
      throwBall.style.transform = `translateX(-50%)`;
      if (dyTotal < -70){
        const speed = Math.min(1.6, Math.max(0.6, (-dyTotal) / dt * 2.2));
        animateThrow(speed);
      } else {
        showToast("SWIPE UP!");
      }
      touch.active = false;
    });

    showToast("READY");
  </script>
</body>
</html>