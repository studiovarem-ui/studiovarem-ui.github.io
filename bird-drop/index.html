<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#87CEEB">
  <title>BIRD DROP</title>
  <link rel="manifest" href="manifest.json">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
    html, body { width: 100%; height: 100%; overflow: hidden; touch-action: none; font-family: 'Press Start 2P', monospace; background: #87CEEB; position: fixed; }
    #gameContainer { width: 100vw; height: 100vh; height: 100dvh; display: flex; flex-direction: column; background: linear-gradient(180deg, #87CEEB 0%, #E0F4FF 50%, #98D4BB 100%); }
    
    /* Top UI Bar */
    #topUI { display: flex; flex-wrap: wrap; padding: 8px; gap: 6px; background: rgba(255,255,255,0.3); border-bottom: 3px solid #5B8C5A; }
    .ui-box { background: #4A7C59; border: 3px solid #2D5A3D; border-radius: 8px; padding: 6px 10px; color: white; font-size: 10px; display: flex; align-items: center; gap: 4px; }
    .ui-box.bird-box { min-width: 70px; flex-direction: column; }
    .ui-box.energy-bar { flex: 1; min-width: 120px; }
    .energy-fill { height: 16px; background: #FFD93D; border-radius: 4px; transition: width 0.2s; }
    .energy-bg { flex: 1; background: #2D5A3D; border-radius: 4px; overflow: hidden; }
    #topUI .right-section { display: flex; gap: 6px; margin-left: auto; }
    .ui-box.clickable { cursor: pointer; }
    .ui-box.clickable:active { transform: scale(0.95); }
    
    /* Game Canvas Area */
    #gameArea { flex: 1; position: relative; overflow: hidden; }
    #gameCanvas { width: 100%; height: 100%; display: block; image-rendering: pixelated; }
    #comboDisplay { position: absolute; top: 10px; right: 10px; background: #FF6B6B; color: white; padding: 8px 12px; border-radius: 10px; border: 3px solid #C94C4C; font-size: 14px; display: none; }
    #poopGauge { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 30px; height: 200px; background: #2D5A3D; border: 3px solid #4A7C59; border-radius: 15px; overflow: hidden; }
    #poopGaugeFill { position: absolute; bottom: 0; width: 100%; background: linear-gradient(180deg, #8B6914 0%, #6B4F0A 100%); border-radius: 12px; transition: height 0.1s; }
    
    /* Bottom Controls */
    #bottomControls { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.4); border-top: 3px solid #5B8C5A; height: 180px; }
    #joystickArea { width: 120px; height: 120px; position: relative; }
    #joystickBase { width: 100%; height: 100%; background: radial-gradient(circle, #98D4BB 0%, #5B8C5A 100%); border: 4px solid #2D5A3D; border-radius: 50%; position: absolute; }
    #joystickKnob { width: 50px; height: 50px; background: radial-gradient(circle, #FFD93D 0%, #F4A623 100%); border: 3px solid #C17F17; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
    
    #rightControls { display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
    #itemButtons { display: flex; gap: 8px; }
    .item-btn { width: 50px; height: 50px; background: linear-gradient(180deg, #98D4BB 0%, #5B8C5A 100%); border: 3px solid #2D5A3D; border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
    .item-btn .icon { font-size: 20px; }
    .item-btn .count { position: absolute; bottom: 2px; right: 4px; font-size: 8px; color: #2D5A3D; }
    .item-btn:active { transform: scale(0.9); background: linear-gradient(180deg, #FFD93D 0%, #F4A623 100%); }
    
    #poopButton { width: 90px; height: 90px; background: radial-gradient(circle, #C9A86C 0%, #8B6914 100%); border: 5px solid #6B4F0A; border-radius: 50%; font-size: 40px; display: flex; justify-content: center; align-items: center; box-shadow: 0 6px 12px rgba(0,0,0,0.4); }
    #poopButton:active { transform: scale(0.9); box-shadow: 0 2px 4px rgba(0,0,0,0.4); }
    
    /* Overlays */
    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(180deg, #87CEEB 0%, #E0F4FF 50%, #98D4BB 100%); display: none; flex-direction: column; z-index: 100; overflow-y: auto; }
    .overlay.active { display: flex; }
    .overlay-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
    
    .game-title { font-size: 28px; color: #2D5A3D; text-shadow: 3px 3px 0 #FFD93D, -1px -1px 0 white; margin-bottom: 10px; text-align: center; }
    .game-subtitle { font-size: 12px; color: #4A7C59; margin-bottom: 30px; }
    
    .menu-btn { padding: 15px 40px; font-family: 'Press Start 2P', monospace; font-size: 14px; border: 4px solid #2D5A3D; border-radius: 15px; margin: 10px; background: linear-gradient(180deg, #98D4BB 0%, #5B8C5A 100%); color: #2D5A3D; min-width: 200px; cursor: pointer; }
    .menu-btn:active { background: linear-gradient(180deg, #FFD93D 0%, #F4A623 100%); transform: scale(0.95); }
    .menu-btn.secondary { background: linear-gradient(180deg, #E8E8E8 0%, #B8B8B8 100%); }
    
    /* Shop Overlay */
    .shop-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.5); border-bottom: 3px solid #5B8C5A; width: 100%; }
    .shop-title { font-size: 16px; color: #2D5A3D; }
    .shop-currency { display: flex; gap: 10px; font-size: 10px; }
    .currency-item { background: #4A7C59; padding: 6px 10px; border-radius: 8px; color: white; border: 2px solid #2D5A3D; }
    
    .shop-tabs { display: flex; width: 100%; border-bottom: 3px solid #5B8C5A; }
    .shop-tab { flex: 1; padding: 12px; background: #B8D4BE; color: #4A7C59; font-size: 10px; text-align: center; border: none; cursor: pointer; }
    .shop-tab.active { background: #4A7C59; color: white; }
    
    .shop-items { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 15px; width: 100%; max-width: 400px; }
    .shop-item { background: linear-gradient(180deg, #E8F5E9 0%, #A5D6A7 100%); border: 3px solid #4A7C59; border-radius: 12px; padding: 12px 8px; display: flex; flex-direction: column; align-items: center; cursor: pointer; aspect-ratio: 1; }
    .shop-item:active { border-color: #FFD93D; background: linear-gradient(180deg, #FFF8E1 0%, #FFD93D 100%); }
    .shop-item.owned { opacity: 0.5; }
    .shop-item.selected { border-color: #FF6B6B; border-width: 4px; }
    .shop-item-icon { font-size: 24px; margin-bottom: 4px; }
    .shop-item-name { font-size: 7px; color: #2D5A3D; text-align: center; }
    .shop-item-price { font-size: 8px; color: #6B4F0A; margin-top: 4px; }
    
    .shop-footer { padding: 15px; border-top: 3px solid #5B8C5A; width: 100%; display: flex; justify-content: center; background: rgba(255,255,255,0.3); }
    
    /* Stage Select */
    .stage-grid { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; padding: 20px; }
    .stage-btn { width: 140px; height: 160px; background: linear-gradient(180deg, #E8F5E9 0%, #A5D6A7 100%); border: 4px solid #4A7C59; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
    .stage-btn.locked { opacity: 0.4; }
    .stage-btn:active:not(.locked) { border-color: #FFD93D; }
    .stage-btn-icon { font-size: 40px; margin-bottom: 8px; }
    .stage-btn-name { font-size: 12px; color: #2D5A3D; margin-bottom: 4px; }
    .stage-btn-stars { font-size: 14px; color: #FFD93D; text-shadow: 1px 1px 0 #C17F17; }
    
    /* Game Over / Clear */
    .result-box { background: rgba(255,255,255,0.9); border: 4px solid #4A7C59; border-radius: 20px; padding: 25px; margin: 20px; text-align: center; }
    .result-title { font-size: 24px; margin-bottom: 15px; }
    .result-title.clear { color: #FFD93D; text-shadow: 2px 2px 0 #C17F17; }
    .result-title.gameover { color: #FF6B6B; text-shadow: 2px 2px 0 #C94C4C; }
    .result-stars { font-size: 30px; margin-bottom: 15px; }
    .result-stats { background: #E8F5E9; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
    .result-stat { display: flex; justify-content: space-between; font-size: 10px; color: #2D5A3D; margin: 8px 0; }
    
    .notification { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: #4A7C59; color: white; padding: 10px 20px; border-radius: 10px; border: 3px solid #2D5A3D; font-size: 10px; z-index: 500; opacity: 0; transition: opacity 0.3s; }
    .notification.show { opacity: 1; }
  </style>
</head>
<body>
  <div id="gameContainer">
    <!-- Top UI -->
    <div id="topUI">
      <div class="ui-box bird-box">
        <canvas id="birdIcon" width="32" height="32"></canvas>
        <span id="levelText">Lv.1</span>
      </div>
      <div class="ui-box energy-bar">
        <span>âš¡</span>
        <div class="energy-bg"><div class="energy-fill" id="energyFill" style="width:100%"></div></div>
      </div>
      <div class="ui-box" id="featherBox">ğŸª¶ <span id="featherCount">0</span></div>
      <div class="ui-box" id="goldBox">âœ¨ <span id="goldCount">0</span></div>
      <div class="ui-box" id="stoneBox">ğŸ’ <span id="stoneCount">0</span></div>
      <div class="right-section">
        <div class="ui-box clickable" id="stageBtn" onclick="showStageSelect()">ğŸ¯</div>
        <div class="ui-box clickable" id="pauseBtn" onclick="togglePause()">â¸</div>
      </div>
    </div>
    
    <!-- Game Area -->
    <div id="gameArea">
      <canvas id="gameCanvas"></canvas>
      <div id="comboDisplay">0 COMBO</div>
      <div id="poopGauge"><div id="poopGaugeFill" style="height:100%"></div></div>
    </div>
    
    <!-- Bottom Controls -->
    <div id="bottomControls">
      <div id="joystickArea">
        <div id="joystickBase"></div>
        <div id="joystickKnob"></div>
      </div>
      <div id="rightControls">
        <div id="itemButtons">
          <div class="item-btn" data-slot="0"><span class="icon">ğŸ</span><span class="count">0</span></div>
          <div class="item-btn" data-slot="1"><span class="icon">ğŸ’Š</span><span class="count">0</span></div>
          <div class="item-btn" data-slot="2"><span class="icon">ğŸ›¡ï¸</span><span class="count">0</span></div>
        </div>
        <div id="poopButton">ğŸ’©</div>
      </div>
    </div>
    
    <!-- Main Menu -->
    <div id="mainMenu" class="overlay active">
      <div class="overlay-content">
        <div class="game-title">BIRD DROP</div>
        <div class="game-subtitle">ìƒˆë˜¥ ë§ì¶”ê¸°</div>
        <canvas id="menuBird" width="80" height="80" style="margin:20px"></canvas>
        <button class="menu-btn" onclick="showStageSelect()">ì‹œì‘</button>
        <button class="menu-btn secondary" onclick="continueGame()">ì´ì–´í•˜ê¸°</button>
      </div>
    </div>
    
    <!-- Stage Select -->
    <div id="stageSelect" class="overlay">
      <div class="shop-header">
        <span class="shop-title">ìŠ¤í…Œì´ì§€ ì„ íƒ</span>
        <button class="menu-btn" style="padding:8px 15px;font-size:10px;min-width:auto" onclick="showMainMenu()">ë’¤ë¡œ</button>
      </div>
      <div class="overlay-content">
        <div class="stage-grid" id="stageGrid"></div>
      </div>
    </div>
    
    <!-- Shop -->
    <div id="shopOverlay" class="overlay">
      <div class="shop-header">
        <span class="shop-title">ìƒì </span>
        <div class="shop-currency">
          <div class="currency-item">ğŸª¶ <span id="shopFeathers">0</span></div>
          <div class="currency-item">âœ¨ <span id="shopGold">0</span></div>
          <div class="currency-item">ğŸ’ <span id="shopStones">0</span></div>
        </div>
      </div>
      <div class="shop-tabs">
        <button class="shop-tab active" onclick="switchShopTab(this,'items')">ì•„ì´í…œ</button>
        <button class="shop-tab" onclick="switchShopTab(this,'upgrades')">ì—…ê·¸ë ˆì´ë“œ</button>
        <button class="shop-tab" onclick="switchShopTab(this,'evolution')">ì§„í™”</button>
      </div>
      <div class="overlay-content" style="justify-content:flex-start;padding-top:10px">
        <div class="shop-items" id="shopItems"></div>
      </div>
      <div class="shop-footer">
        <button class="menu-btn" onclick="closeShop()">ë‹«ê¸°</button>
      </div>
    </div>
    
    <!-- Pause -->
    <div id="pauseOverlay" class="overlay">
      <div class="overlay-content">
        <div class="result-box">
          <div class="result-title" style="color:#4A7C59">ì¼ì‹œì •ì§€</div>
          <button class="menu-btn" onclick="resumeGame()">ê³„ì†í•˜ê¸°</button>
          <button class="menu-btn secondary" onclick="openShopFromPause()">ìƒì </button>
          <button class="menu-btn secondary" onclick="quitToMenu()">ë‚˜ê°€ê¸°</button>
        </div>
      </div>
    </div>
    
    <!-- Stage Clear -->
    <div id="clearOverlay" class="overlay">
      <div class="overlay-content">
        <div class="result-box">
          <div class="result-title clear">â˜… CLEAR â˜…</div>
          <div class="result-stars" id="clearStars">â­â­â­</div>
          <div class="result-stats">
            <div class="result-stat"><span>ì ìˆ˜</span><span id="clearScore">0</span></div>
            <div class="result-stat"><span>ëª…ì¤‘ë¥ </span><span id="clearAccuracy">0%</span></div>
            <div class="result-stat"><span>ê¹ƒí„¸</span><span id="clearFeathers">ğŸª¶ 0</span></div>
            <div class="result-stat"><span>ë³´ì„</span><span id="clearGold">âœ¨ 0</span></div>
          </div>
          <button class="menu-btn" onclick="openShop()">ìƒì </button>
          <button class="menu-btn secondary" onclick="showStageSelect()">ë‹¤ìŒ</button>
        </div>
      </div>
    </div>
    
    <!-- Game Over -->
    <div id="gameoverOverlay" class="overlay">
      <div class="overlay-content">
        <div class="result-box">
          <div class="result-title gameover">GAME OVER</div>
          <div class="result-stats">
            <div class="result-stat"><span>ì ìˆ˜</span><span id="goScore">0</span></div>
            <div class="result-stat"><span>ê¹ƒí„¸</span><span id="goFeathers">ğŸª¶ 0</span></div>
          </div>
          <button class="menu-btn" onclick="retryStage()">ë‹¤ì‹œí•˜ê¸°</button>
          <button class="menu-btn secondary" onclick="showStageSelect()">ë‚˜ê°€ê¸°</button>
        </div>
      </div>
    </div>
    
    <div id="notification" class="notification"></div>
  </div>
  <script src="game.js"></script>
</body>
</html>